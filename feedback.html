<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback - GlowSkin Clinic</title>
</head>
<body style="margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif;line-height:1.6;color:#2c3e50;background:linear-gradient(135deg,#f8bbd9,#e91e63);min-height:100vh;">
    
    <!-- Navigation -->
    <nav style="background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);padding:1rem 5%;position:fixed;width:100%;top:0;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
        <div style="max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;">
            <div style="font-size:1.8rem;font-weight:bold;color:#e91e63;">GlowSkin Clinic</div>
            <ul style="display:flex;list-style:none;gap:2rem;">
                <li><a href="index.html" style="text-decoration:none;color:#2c3e50;font-weight:500;">Home</a></li>
                <li><a href="services.html" style="text-decoration:none;color:#2c3e50;font-weight:500;">Services</a></li>
                <li><a href="products.html" style="text-decoration:none;color:#2c3e50;font-weight:500;">Products</a></li>
                <li><a href="cart.html" style="text-decoration:none;color:#2c3e50;font-weight:500;">Cart</a></li>
                <li><a href="feedback.html" style="text-decoration:none;color:#e91e63;font-weight:700;">Feedback</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <section style="padding:140px 5% 80px;max-width:900px;margin:0 auto;">
        <h2 style="text-align:center;font-size:2.5rem;margin-bottom:3rem;color:#2c3e50;">Share Your Experience</h2>
        
        <!-- VALIDATED FEEDBACK FORM -->
        <form id="feedbackForm" style="background:white;padding:2.5rem;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,0.1);">
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Full Name *</label>
                <input type="text" id="fbName" required style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-size:1rem;">
                <span id="nameError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Mobile Number *</label>
                <input type="tel" id="fbMobile" placeholder="10-digit number" required style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-size:1rem;">
                <span id="mobileError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Email (optional)</label>
                <input type="email" id="fbEmail" style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-size:1rem;">
                <span id="emailError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Service *</label>
                <input type="text" id="fbService" required style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-size:1rem;">
                <span id="serviceError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Rating (1-5) *</label>
                <input type="number" id="fbRating" min="1" max="5" required style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-size:1rem;">
                <span id="ratingError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <div style="margin-bottom:1.5rem;">
                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">Feedback *</label>
                <textarea id="fbFeedback" rows="5" required style="width:100%;padding:12px;border:2px solid #ecf0f1;border-radius:10px;font-family:inherit;resize:vertical;"></textarea>
                <span id="feedbackError" class="error" style="color:#e74c3c;font-size:0.85rem;margin-top:4px;display:block;"></span>
            </div>
            
            <button type="submit" style="background:#e91e63;color:white;border:none;padding:15px 40px;border-radius:50px;font-size:1.1rem;cursor:pointer;display:block;margin:0 auto;width:100%;">Submit</button>
        </form>

        <!-- Saved feedbacks and CSV export -->
        <div id="savedFeedbacks" style="margin-top:2rem;background:rgba(255,255,255,0.9);padding:1.25rem;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem;">
                <h3 style="margin:0;font-size:1.25rem;color:#2c3e50;">Saved Feedbacks</h3>
                <div>
                    <button id="downloadAllBtn" style="background:#2c3e50;color:white;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;margin-right:8px;">Download all CSV</button>
                    <button id="clearAllBtn" style="background:#e74c3c;color:white;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;">Clear all</button>
                </div>
            </div>
            <div style="overflow:auto;max-height:360px;">
                <table id="feedbackTable" style="width:100%;border-collapse:collapse;font-size:0.95rem;">
                    <thead style="position:sticky;top:0;background:#fff;">
                        <tr>
                            <th style="text-align:left;padding:8px;border-bottom:1px solid #ecf0f1;">Name</th>
                            <th style="text-align:left;padding:8px;border-bottom:1px solid #ecf0f1;">Mobile</th>
                            <th style="text-align:left;padding:8px;border-bottom:1px solid #ecf0f1;">Service</th>
                            <th style="text-align:left;padding:8px;border-bottom:1px solid #ecf0f1;">Rating</th>
                            <th style="text-align:left;padding:8px;border-bottom:1px solid #ecf0f1;">Date</th>
                        </tr>
                    </thead>
                    <tbody id="feedbackTbody">
                        <!-- populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- COMPLETE VALIDATION + CSV SCRIPT -->
    <script>
        // Helper: render saved feedbacks from localStorage into the table
        function renderFeedbacks() {
            const tbody = document.getElementById('feedbackTbody');
            tbody.innerHTML = '';
            const feedbacks = JSON.parse(localStorage.getItem('skinClinicFeedbacks')) || [];
            if (feedbacks.length === 0) {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td colspan="5" style="padding:12px;color:#7f8c8d;">No feedbacks saved yet.</td>';
                tbody.appendChild(tr);
                return;
            }
            feedbacks.slice().reverse().forEach(fb => { // show latest first
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding:8px;border-bottom:1px solid #f0f0f0;">${escapeHtml(fb.name)}</td>
                    <td style="padding:8px;border-bottom:1px solid #f0f0f0;">${escapeHtml(fb.mobile)}</td>
                    <td style="padding:8px;border-bottom:1px solid #f0f0f0;">${escapeHtml(fb.service)}</td>
                    <td style="padding:8px;border-bottom:1px solid #f0f0f0;">${escapeHtml(String(fb.rating))}</td>
                    <td style="padding:8px;border-bottom:1px solid #f0f0f0;">${escapeHtml(fb.date)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Escape to avoid injecting HTML
        function escapeHtml(str) {
            if (!str && str !== 0) return '';
            return String(str)
                .replaceAll('&', '&amp;')
                .replaceAll('<', '&lt;')
                .replaceAll('>', '&gt;')
                .replaceAll('"', '&quot;')
                .replaceAll("'", '&#39;');
        }

        // Download all saved feedbacks as CSV
        function downloadAllFeedbacksCSV() {
            const feedbacks = JSON.parse(localStorage.getItem('skinClinicFeedbacks')) || [];
            if (feedbacks.length === 0) {
                alert('No feedbacks to download.');
                return;
            }
            const headers = ['Name','Mobile','Email','Service','Rating','Feedback','Date'];
            const rows = feedbacks.map(fb => [
                `"${fb.name.replace(/"/g,'""')}"`,
                fb.mobile,
                fb.email ? `"${fb.email.replace(/"/g,'""')}"` : '',
                `"${fb.service.replace(/"/g,'""')}"`,
                fb.rating,
                `"${fb.feedback.replace(/"/g,'""')}"`,
                `"${fb.date.replace(/"/g,'""')}"`
            ].join(','));
            const csvContent = [headers.join(','), ...rows].join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `GlowSkin_Feedbacks_All_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Clear all saved feedbacks
        function clearAllFeedbacks() {
            if (!confirm('Clear all saved feedbacks? This cannot be undone.')) return;
            localStorage.removeItem('skinClinicFeedbacks');
            renderFeedbacks();
        }

        document.getElementById('downloadAllBtn').addEventListener('click', downloadAllFeedbacksCSV);
        document.getElementById('clearAllBtn').addEventListener('click', clearAllFeedbacks);

        document.getElementById('feedbackForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Clear previous errors
            document.querySelectorAll('.error').forEach(span => span.textContent = '');
            let isValid = true;
            
            // Name validation
            const name = document.getElementById('fbName').value.trim();
            if (name.length < 2) {
                document.getElementById('nameError').textContent = 'Name must be at least 2 characters';
                isValid = false;
            }
            
            // Mobile validation (10 digits only)
            const mobile = document.getElementById('fbMobile').value.replace(/\D/g, '');
            if (mobile.length !== 10) {
                document.getElementById('mobileError').textContent = 'Enter valid 10-digit mobile number';
                isValid = false;
            }
            
            // Email validation (optional)
            const email = document.getElementById('fbEmail').value.trim();
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                document.getElementById('emailError').textContent = 'Enter valid email address';
                isValid = false;
            }
            
            // Service validation
            const service = document.getElementById('fbService').value.trim();
            if (service.length < 2) {
                document.getElementById('serviceError').textContent = 'Please enter service name';
                isValid = false;
            }
            
            // Rating validation
            const rating = parseInt(document.getElementById('fbRating').value);
            if (isNaN(rating) || rating < 1 || rating > 5) {
                document.getElementById('ratingError').textContent = 'Rating must be between 1-5';
                isValid = false;
            }
            
            // Feedback validation
            const feedback = document.getElementById('fbFeedback').value.trim();
            if (feedback.length < 10) {
                document.getElementById('feedbackError').textContent = 'Feedback must be at least 10 characters';
                isValid = false;
            }
            
            // If all valid, save & update UI
            if (isValid) {
                const feedbackData = {
                    name: name,
                    mobile: mobile,
                    email: email,
                    service: service,
                    rating: rating,
                    feedback: feedback,
                    date: new Date().toLocaleString('en-IN')
                };
                
                // Save to LocalStorage (append)
                let feedbacks = JSON.parse(localStorage.getItem('skinClinicFeedbacks')) || [];
                feedbacks.push(feedbackData);
                localStorage.setItem('skinClinicFeedbacks', JSON.stringify(feedbacks));
                
                // Update displayed list
                renderFeedbacks();
                
                // Optionally download all feedbacks as CSV (appends logically to stored list)
                // You can comment the next line out if you don't want automatic download on submit
                // downloadAllFeedbacksCSV();

                alert('âœ… Thank you! Feedback saved. You can download all feedbacks using "Download all CSV".');
                this.reset();
            }
        });

        // Render on load
        window.addEventListener('DOMContentLoaded', renderFeedbacks);
    </script>
</body>
</html>

    
            

